<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'Error ' + (${status} ?: 500) + ' — ' + (${error} ?: 'Unexpected')">Error</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --red:#dc2626; --bg:#f4f4f4; --card:#fff; --btn:#80FAC0; --ink:#111827; --muted:#6b7280;
        }
        @media (prefers-color-scheme: dark) {
            :root { --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --muted:#9ca3af; --btn:#34d399; }
        }
        * { box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
            background-color: var(--bg); color: var(--ink);
            display:flex; align-items:center; justify-content:center; min-height:100vh;
            margin:0; padding:1rem;
        }
        .container {
            background: var(--card); width:100%; max-width: 640px;
            padding:2rem; border-radius:12px; box-shadow:0 6px 24px rgba(0,0,0,.08);
            text-align:center;
        }
        .code {
            display:inline-block; padding:.25rem .5rem; border-radius:6px;
            background:#111827; color:#FFF; font-weight:700; letter-spacing:.02em; margin-bottom:.75rem;
        }
        h1 { margin:.25rem 0 0; font-size:1.5rem; }
        .error-message { color: var(--red); margin: 1rem 0 1.25rem; line-height:1.45; }
        .meta { font-size:.9rem; color:var(--muted); margin:.25rem 0 1rem; }
        .tips { text-align:left; margin:0 auto 1rem; max-width:48ch; color:var(--muted); }
        .tips li { margin:.25rem 0; }
        .buttons { display:flex; gap:.5rem; justify-content:center; flex-wrap:wrap; margin-top: .5rem; }
        .button {
            display:inline-block; text-decoration:none; background: var(--btn); color:#000;
            padding:.6rem 1rem; border-radius:8px; font-weight:600; border:0; cursor:pointer;
        }
        .ghost { background:#e5e7eb; }
        @media (prefers-color-scheme: dark) {
            .ghost { background:#374151; color:#e5e7eb; }
        }
        details {
            text-align:left; margin:1rem auto 0; max-width: 100%; background: rgba(0,0,0,.04);
            padding:.75rem; border-radius:8px;
        }
        details pre {
            overflow:auto; margin:.5rem 0 0; padding:.5rem; background: rgba(0,0,0,.06);
            border-radius:6px;
        }
    </style>
</head>
<body>
<div class="container"
     th:with="
        code=${status}?:500,
        is404=${status}==404,
        is403=${status}==403,
        is401=${status}==401,
        is400=${status}==400,
        is5xx=${status}>=500
     ">

    <span class="code" th:text="${code}">500</span>

    <!-- Friendly headline per class of error -->
    <h1 th:text="${is404} ? 'Page not found'
                 : (${is403} ? 'Access denied'
                 : (${is401} ? 'Authentication required'
                 : (${is400} ? 'Bad request'
                 : (${is5xx} ? 'Server error' : (${error} ?: 'Unexpected error')))))">
        Unexpected error
    </h1>

    <!-- Human message -->
    <p class="error-message"
       th:text="${message} ?: (${is404} ? 'We couldn’t find what you were looking for.'
                 : (${is403} ? 'You don’t have permission to view this page.'
                 : (${is401} ? 'Please sign in to continue.'
                 : (${is5xx} ? 'Something went wrong on our side.'
                 : 'Something went wrong. Please try again.'))))">
        Something went wrong. Please try again.
    </p>

    <!-- tiny meta -->
    <p class="meta" th:if="${path} or ${timestamp} or ${requestId} or ${traceId}">
        <span th:if="${path}">Path: <span th:text="${path}">/</span></span>
        <span th:if="${timestamp}"> • <span th:text="${#temporals.format(timestamp, 'yyyy-MM-dd HH:mm:ssXXX')}">now</span></span>
        <span th:if="${requestId}"> • Request ID: <span th:text="${requestId}">req-…</span></span>
        <span th:if="${traceId}"> • Trace ID: <span th:text="${traceId}">trace-…</span></span>
    </p>

    <!-- gentle hints -->
    <ul class="tips" th:if="${is404} or ${is403} or ${is401}">
        <li th:if="${is404}">Check the URL or use the buttons below to navigate.</li>
        <li th:if="${is403}">If this is unexpected, try signing out and back in, or contact support.</li>
        <li th:if="${is401}">Please sign in, then try again.</li>
    </ul>

    <div class="buttons">
        <button type="button" class="button ghost"
                onclick="if (history.length>1) { history.back(); } else { window.location.href='/' }">
            Go back
        </button>
        <a class="button ghost" th:href="@{/}">Go home</a>

        <!-- Role-based shortcuts -->
        <div th:if="${#authorization.expression('hasRole(''ROLE_DOCTOR'')')}">
            <a class="button" th:href="@{/doctor/dashboard}">Back to Dashboard</a>
        </div>
        <div th:if="${#authorization.expression('hasRole(''ROLE_PATIENT'')')}">
            <a class="button" th:href="@{/patient/dashboard}">Back to Dashboard</a>
        </div>
    </div>

    <!-- Technical details (hidden unless ?debug is present or a trace is provided) -->
    <details th:if="${param.debug} or ${trace}">
        <summary>Technical details</summary>
        <div class="meta">
            <div>Exception: <span th:text="${exception} ?: 'n/a'">n/a</span></div>
        </div>
        <pre th:text="${trace} ?: 'No stack trace available.'">No stack trace available.</pre>
    </details>
</div>
</body>
</html>
